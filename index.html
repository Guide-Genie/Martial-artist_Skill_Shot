<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>무도가 스킬 타임라인 조합기</title>
  <style>
    body { background: #1e1e1e; color: #eee; font-family: 'Noto Sans KR', sans-serif; padding: 20px; }
    h1 { font-size: 1.8em; color: #ff6600; }
    select, input { padding: 5px; margin-right: 10px; }
    .skill-container, .timeline-wrapper { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
    .skill, .slot {
      background: #2e2e2e;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      min-width: 120px;
      min-height: 100px;
      cursor: grab;
    }
    .slot { background: #3a3a3a; position: relative; }
    .highlight { background: #33691E; color: #fff; }
    img { max-width: 40px; display: block; margin: 0 auto 5px; }
    .damage-text { margin-top: 5px; font-size: 0.9em; }
    .level-controls { display: flex; justify-content: center; gap: 5px; margin-top: 5px; }
    .level-controls button { padding: 2px 8px; }
    .timeline-row { width: 100%; display: flex; gap: 10px; margin-bottom: 10px; }
    .remove-btn {
      position: absolute;
      top: 2px; right: 5px;
      cursor: pointer;
      color: red;
      font-weight: bold;
    }
    .total-line-damage { font-weight: bold; font-size: 1em; color: #ffc107; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>무도가 스킬 타임라인 조합기</h1>
  <div>
    <label>종족:
      <select id="raceSelect">
        <option value="포유류">포유류</option>
        <option value="조류">조류</option>
        <option value="파충류">파충류</option>
      </select>
    </label>
    <label>수동 체력 입력:
      <input id="manualHP" type="number" placeholder="예: 176798">
    </label>
    <span id="hpDisplay" style="color:orange; font-weight:bold"></span>
  </div>

  <h2>스킬 목록</h2>
  <div class="skill-container" id="skillList"></div>

  <h2>타임라인</h2>
  <div class="timeline-wrapper" id="timelineWrapper"></div>

  <script>
    const skills = [
      { id: 'magu', name: '마구때리기', race: '포유류', max: 10, img: 'images/magu.png', damage: [52137,104274,156411,208548,260685,312822,364959,417096,469233,521370], cooldown: 10 },
      { id: 'yangson', name: '양손공격', race: '포유류', max: 10, img: 'images/yangson.png', damage: [20275,40550,60825,81037,101287,121537,141787,162037,182287,202537], cooldown: 4 },
      { id: 'jiyeol', name: '지열참', race: '포유류', max: 10, img: 'images/jiyeol.png', damage: [162206,324412,486618,648824,811030,973236,1135442,1297648,1459854,1622060], cooldown: 34 },
      { id: 'jjogi', name: '쪼기', race: '조류', max: 10, img: 'images/jjogi.png', damage: [22488,44972,67458,89942,112426,134910,157394,179878,202362,224846], cooldown: 4 },
      { id: 'maeui', name: '매의위상', race: '조류', max: 10, img: 'images/maeui.png', damage: [88269,176538,264807,353076,441345,529614,617883,706152,794421,882690], cooldown: 16 },
      { id: 'wind', name: '윈드쉐이커', race: '조류', max: 10, img: 'images/wind.png', damage: [123576,247152,370728,494304,617880,741456,865032,988608,1112184,1235760], cooldown: 22 },
      { id: 'tail', name: '꼬리치기', race: '파충류', max: 10, img: 'images/tail.png', damage: [240680,477268,714579,950927,1188237,1424585,1661895,1898725,2135554,2371901], cooldown: 28 },
      { id: 'claw', name: '할퀴기', race: '파충류', max: 10, img: 'images/claw.png', damage: [102980,205857,308736,411612,514490,617368,720245,823123,926001,1028879], cooldown: 12 }
    ];

    const timelineWrapper = document.getElementById("timelineWrapper");
    const skillList = document.getElementById("skillList");
    const hpDisplay = document.getElementById("hpDisplay");
    const raceSelect = document.getElementById("raceSelect");
    const manualHP = document.getElementById("manualHP");

    let selectedHP = 0;
    let skillLevels = {};
    skills.forEach(s => skillLevels[s.id] = 1);

    function updateHPDisplay() {
      selectedHP = parseInt(manualHP.value || 0);
      hpDisplay.textContent = `목표 체력: ${selectedHP.toLocaleString()} HP`;
      updateTimelineColor();
    }

    function updateSkillList() {
      skillList.innerHTML = "";
      const race = raceSelect.value;
      skills.forEach(skill => {
        const maxLevel = race === skill.race ? 10 : (skill.id === 'jiyeol' ? 2 : (['magu','yangson'].includes(skill.id) ? 4 : 4));
        skillLevels[skill.id] = Math.min(skillLevels[skill.id], maxLevel);

        const div = document.createElement("div");
        div.className = "skill";
        div.draggable = true;
        div.dataset.skill = skill.id;
        div.innerHTML = `<img src="${skill.img}"><div>${skill.name}</div><div class="damage-text">${skill.damage[skillLevels[skill.id]-1].toLocaleString()} 데미지</div><div class="level-controls"><button onclick="changeLevel('${skill.id}', -1)">-</button><span>${skillLevels[skill.id]}</span><button onclick="changeLevel('${skill.id}', 1)">+</button></div>`;
        div.addEventListener("dragstart", e => e.dataTransfer.setData("text/plain", skill.id));
        skillList.appendChild(div);
      });
    }

    function changeLevel(id, delta) {
      const race = raceSelect.value;
      const skill = skills.find(s => s.id === id);
      const limit = race === skill.race ? 10 : (id === 'jiyeol' ? 2 : (['magu','yangson'].includes(id) ? 4 : 4));
      skillLevels[id] = Math.max(1, Math.min(limit, skillLevels[id] + delta));
      updateSkillList();
    }

    function createTimelineRows() {
      timelineWrapper.innerHTML = "";
      for (let row = 0; row < 5; row++) {
        const rowDiv = document.createElement("div");
        rowDiv.className = "timeline-row";
        rowDiv.dataset.row = row;

        for (let col = 0; col < 8; col++) {
          const slot = document.createElement("div");
          slot.className = "slot";
          slot.addEventListener("dragover", e => e.preventDefault());
          slot.addEventListener("drop", e => {
            const id = e.dataTransfer.getData("text/plain");
            const skill = skills.find(s => s.id === id);
            if (skill) {
              const damage = skill.damage[skillLevels[id]-1];
              slot.innerHTML = `<span class='remove-btn' onclick='this.parentElement.innerHTML="";this.parentElement.dataset.damage="0";updateTimelineColor();'>✖</span><img src="${skill.img}"><div>${skill.name}</div><div class="damage-text">${damage.toLocaleString()} 데미지</div>`;
              slot.dataset.damage = damage;
              updateTimelineColor();
            }
          });
          rowDiv.appendChild(slot);
        }

        const dmgDiv = document.createElement("div");
        dmgDiv.className = "total-line-damage";
        dmgDiv.id = `lineDamage${row}`;
        timelineWrapper.appendChild(rowDiv);
        timelineWrapper.appendChild(dmgDiv);
      }
    }

    function updateTimelineColor() {
      let grandTotal = 0;
      for (let row = 0; row < 5; row++) {
        let total = 0;
        const rowElem = document.querySelector(`.timeline-row[data-row='${row}']`);
        rowElem.querySelectorAll(".slot").forEach(slot => {
          total += parseInt(slot.dataset.damage || 0);
        });
        document.getElementById(`lineDamage${row}`).textContent = `샷 ${row + 1} 합계: ${total.toLocaleString()} 데미지`;
        document.getElementById(`lineDamage${row}`).classList.toggle("highlight", selectedHP && total >= selectedHP);
        grandTotal += total;
      }
    }

    manualHP.addEventListener("input", updateHPDisplay);
    raceSelect.addEventListener("change", () => {
      updateSkillList();
    });

    updateHPDisplay();
    updateSkillList();
    createTimelineRows();
  </script>
</body>
</html>
